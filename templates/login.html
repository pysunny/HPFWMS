{% extends 'base_user.html' %}
{% load staticfiles %}
{% block title %}HPFWMS-用户登录{% endblock title %}
{% block form %}
<form method="post" class="layui-form">
  {% csrf_token %}
  <div class="layui-form-item">
    <input name="username" placeholder="请输入用户名"  type="text" lay-verify="required" class="layui-input" >
  </div>
  <div class="layui-form-item">
    <input name="pwd" lay-verify="required" placeholder="请输入密码"  type="password" class="layui-input">
  </div>
  <div class="layui-form-item">
      <input type="checkbox" name="remember" lay-skin="primary" title="记住密码">
  </div>
  <div class="layui-form-item">
    <input value="登录" lay-submit lay-filter="login" style="width:100%;" type="submit">
  </div>
  <div align="center">
    <a href="#">忘记密码了？</a> | <a href="{% url 'user:register' %}">注册一个新账号</a>
  </div>
</form>
{% endblock form %}

{% block bottomfiles %}
<script>
  $(function  () {
    layui.use('form', function(){
      var form = layui.form;
      form.on('submit(login)', function(data){
        // 添加csrf_token
        data.field.csrfmiddlewaretoken = $("[name='csrfmiddlewaretoken']").val()
        // ajax请求
        $.post("{% url 'user:login' %}", data.field, function (data) {
          if (data.res == 4) {
            // 登录通过
            layer.msg("登录成功",function(){
              location.href='#'
            });
          }
          else{
            // 数据验证有问题
            layer.msg(data.errmsg, {
              time: 5000, //5s后自动关闭
            });
          }
        })
        return false;
      });
    });
  })
</script>
{% endblock bottomfiles %}
